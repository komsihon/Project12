{% extends 'core/base_bs.html' %}
{% load i18n static user_agents %}

{% block meta %}
    {{ block.super }}
    <link rel="shortcut icon" type="image/png" href="{% static 'daraja/img/logo-daraja.png' %}">
    <meta name="theme-color" content="#233682">
    <meta name="msapplication-navbutton-color" content="#233682">
    <meta name="apple-mobile-web-app-status-bar-style" content="#233682">
{% endblock %}

{% block page_title %}
    <title>{% blocktrans %}Partnership invitation from {{ company_name }}{% endblocktrans %} - ikwen Daraja</title>
{% endblock %}

{% block head_style %}
    {{ block.super }}
    <!-- Custom css -->
    <link rel="stylesheet" type="text/css" href="{% static 'ikwen/css/deploy-minimal.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'daraja/css/daraja-admin.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'daraja/css/daraja.css' %}">
    <style>
        footer {position: static; margin-top: 60px}
        body > .container {font-size: 18px; margin-top: 12vh}
        body > .container .btn {width: 240px}
        .get-started {border: 1px solid #f00; padding: 30px 15px}
        @media (max-width: 767px) {
            body > .container {margin-top: 10vh}
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="text-center">
<!--            style="background: #f7f7f7"-->
            <img class="main-img" src="{% static 'daraja/img/logo-daraja.png' %}" />
            <h2 class="main-title text-center" style="padding: 4vh 0; font-weight: bold;">
                {% blocktrans %}Invitation from {{ company_name }}{% endblocktrans %}
            </h2>
        </div>
        <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2">
            <div>
                <p style="text-align: center;">{% blocktrans %}
                    <strong>{{ company_name }}</strong> is inviting you to become partner through Daraja program.
                    <br>Get {{ share_rate }}% for online purchases made by people you refer.
                    <br>You receive money immediately after transactions.
                {% endblocktrans %}</p>
                <div class="clearfix"></div>
            </div>
            <div class="text-center accept" style="margin-top: 5vh">
                <button class="btn btn-deep-blue">
                    {% include 'core/snippets/button_spinner.html' %}
                    <strong>{% trans "Accept" %}</strong>
                </button>
            </div>
            <div class="text-center get-started" style="display: none; font-size: .9em; margin-top: 5vh">
                <p class="text-danger">{% blocktrans %}
                    You're not yet on Daraja. You must join the program before you can
                    partnership with {{ company_name }}.
                {% endblocktrans %}</p>
                <a href="{% url 'daraja:home' %}?inviter={{ ikwen_name }}" class="btn btn-green">
                    {% include 'core/snippets/button_spinner.html' %}
                    <strong>{% trans "Join the program" %}</strong>
                </a>
            </div>
            <div class="col-xs-12 col-sm-10 col-sm-offset-1 text-center invitation-accepted" style="display: none; font-size: .9em; margin-top: 5vh">
                <p class="text-success">{% blocktrans with company_url=company.url %}
                    Great! You are now partner with {{ company_name }}. Get {{ share_rate }}% for getting someone to buy
                    online on {{ company_url }}. You must invite them first by sharing your link below.
                {% endblocktrans %}</p>
{#                <a href="{% url 'ikwen:company_profile' ikwen_name %}?referrer={{ user.id }}" class="btn btn-green">#}
{#                    {% include 'core/snippets/button_spinner.html' %}#}
{#                    <strong>{% trans "Invite someone now" %}</strong>#}
{#                </a>#}
                <div class="row">
                    <div class="col-sm-4 col-xs-4" data-href="{{ service.url }}{{ product_url }}" data-layout="button" data-mobile-iframe="true">
                        <a class="social-share btn btn-block" target="_blank"  href="https://www.facebook.com/sharer/sharer.php?u={{ service.url }}"  style="background: #3b5998;">
                            <i class="fab fa-facebook"></i>
                        </a>
                    </div>
                    <div class="col-sm-offset-2  col-sm-4 col-xs-4">
                        <a class="social-share btn btn-block" data-toggle="modal" data-target="#twitter-share" href="https://twitter.com/intent/tweet?url={{ service.url }}{{ product_url }}" style="background: #1da1f2;">
                            <i class="fab fa-twitter"></i>
                        </a>
                    </div>
{#                        <div class="col-sm-4 col-xs-3">#}
{#                            <button class="btn btn-block" data-toggle="modal" data-target="#instagram-share" style="min-width: auto; background: #c32aa3;">#}
{#                                <i class="fab fa-instagram"></i>#}
{#                            </button>#}
{#                        </div>#}
                    <div class="col-xs-4">
                        <button class="social-share btn btn-block visible-xs" data-toggle="modal" data-target="#whatsapp-share" style="background: #25d366;">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
    {#    Modal declaration : BEGIN #}
    <div class="modal fade" id="whatsapp-share" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content modal-info">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">{% trans "Share on WhatsApp" %}</h4>
                </div>
                <div class="modal-body text-center">
                    <form onclick="return false" class="form-horizontal">
                        <div class="form-group row">
                            <label for="whatsapp-share-msg" class="col-sm-5 col-md-4">{% trans "Message" %}</label>
                            <div class="col-sm-7 col-md-8">
                                <textarea id="whatsapp-share-msg" style="height: 120px"
                                          class="form-control input-sm">{% blocktrans %}Hello! Join {{ project_name }} on ikwen and get tons of cool advantages.{% endblocktrans %}</textarea>
                            </div>
                        </div>
                    </form>
                    <div class="actions">
                        <div class="col-xs-12 col-sm-4 col-md-3 pull-right action">
                            <button class="btn btn-success btn-block btn-sm ok"
                                    data-dismiss="modal" aria-label="OK">OK</button>
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-3 pull-right action">
                            <button class="btn btn-default btn-block btn-sm"
                                    data-dismiss="modal" aria-label="Close">{% trans "Cancel" %}</button>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>
    {#    Modal declaration : END #}
{% endblock %}

{% block js %}
    {{ block.super }}
    <script>
        (() => {
            $('.accept .btn').click(() => {
                let _$btn = $(this);
                _$btn.addClass('processing');
                $.getJSON('', {action: 'accept'}, function(data) {
                    _$btn.removeClass('processing');
                    if (data.error) {
                        $('.accept, .get-started').toggle()
                        //$('.accept, .invitation-accepted').toggle()
                    } else if (data.success) {
                        $('.accept, .invitation-accepted').toggle()
                    }
                })
            });
            $('body').on('click', '#whatsapp-share .btn.ok', () => {
                let msg = $('#whatsapp-share-msg').val(),
                    url = 'https://ikwen.com/daraja/invitation/{{ service.project_name_slug }}';
                window.location = 'https://api.whatsapp.com/send?text=' + url + '%0A%0A' + msg;
            });
        })()
    </script>

{% endblock %}